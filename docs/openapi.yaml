openapi: 3.1.0
info:
  title: Radiant Blockchain REST API
  description: |
    REST API for the Radiant blockchain, wrapping ElectrumX and RXinDexer
    Glyph/WAVE/dMint/Swap extension APIs.

    **Base URL:** `http://localhost:3080/api`

    All endpoints return JSON. Amounts are in photons (1 RXD = 100,000,000 photons)
    unless otherwise noted.
  version: 1.2.0
  contact:
    name: Radiant Core
    url: https://github.com/Radiant-Core
  license:
    name: MIT

servers:
  - url: http://localhost:3080/api
    description: Local development

tags:
  - name: Blockchain
    description: Chain state, blocks, transactions, fees
  - name: Address
    description: Balance, UTXOs, history for addresses
  - name: Glyph
    description: Glyph token queries (FT, NFT, dMint, etc.)
  - name: dMint
    description: Decentralized mining contracts
  - name: WAVE
    description: WAVE on-chain naming system
  - name: Swap
    description: On-chain DEX orderbook
  - name: Utility
    description: Address validation, protocol info
  - name: Inference
    description: AI inference proof commitments (Phase 5)
  - name: Identity
    description: AI agent identity via WAVE (Phase 5)
  - name: Access
    description: Token-gated service access (Phase 5)
  - name: Channel
    description: Micropayment channels (Phase 5)
  - name: Marketplace
    description: Data asset marketplace (Phase 5)
  - name: Script
    description: Offline script decode and compile tools
  - name: Health
    description: Connection health monitoring
  - name: Wallet
    description: Wallet creation and recovery (BIP39/BIP32)

paths:
  /chain:
    get:
      operationId: getChainInfo
      summary: Get blockchain status
      tags: [Blockchain]
      responses:
        "200":
          description: Current chain info
          content:
            application/json:
              schema:
                type: object
                properties:
                  height: { type: integer, example: 402710 }
                  headerHex: { type: string }
                  network: { type: string, example: mainnet }
                  ticker: { type: string, example: RXD }

  /block/{height}:
    get:
      operationId: getBlockHeader
      summary: Get block header by height
      tags: [Blockchain]
      parameters:
        - name: height
          in: path
          required: true
          schema: { type: integer, minimum: 0 }
      responses:
        "200":
          description: Block header hex
          content:
            application/json:
              schema:
                type: object
                properties:
                  height: { type: integer }
                  header: { type: string }

  /tx/{txid}:
    get:
      operationId: getTransaction
      summary: Get transaction details
      tags: [Blockchain]
      parameters:
        - name: txid
          in: path
          required: true
          schema: { type: string, minLength: 64, maxLength: 64 }
      responses:
        "200":
          description: Transaction details
          content:
            application/json:
              schema: { type: object }

  /tx:
    post:
      operationId: broadcastTransaction
      summary: Broadcast a signed raw transaction
      tags: [Blockchain]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [raw_tx]
              properties:
                raw_tx: { type: string, description: Signed raw transaction hex }
      responses:
        "200":
          description: Broadcast result
          content:
            application/json:
              schema:
                type: object
                properties:
                  txid: { type: string }

  /fee:
    get:
      operationId: estimateFee
      summary: Estimate transaction fee
      tags: [Blockchain]
      parameters:
        - name: blocks
          in: query
          schema: { type: integer, minimum: 1, maximum: 100, default: 6 }
      responses:
        "200":
          description: Fee estimate
          content:
            application/json:
              schema:
                type: object
                properties:
                  targetBlocks: { type: integer }
                  feePerKb: { type: string }

  /address/{address}/balance:
    get:
      operationId: getBalance
      summary: Get RXD balance for address
      tags: [Address]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
          description: Radiant address (base58check)
      responses:
        "200":
          description: Balance in photons and RXD
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  confirmed: { type: object, properties: { satoshis: { type: integer }, rxd: { type: string } } }
                  unconfirmed: { type: object, properties: { satoshis: { type: integer }, rxd: { type: string } } }

  /address/{address}/utxos:
    get:
      operationId: getUtxos
      summary: List unspent outputs for address
      tags: [Address]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: UTXO list
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  count: { type: integer }
                  utxos:
                    type: array
                    items:
                      type: object
                      properties:
                        txid: { type: string }
                        vout: { type: integer }
                        height: { type: integer }
                        value: { type: object, properties: { satoshis: { type: integer }, rxd: { type: string } } }

  /address/{address}/history:
    get:
      operationId: getHistory
      summary: Get transaction history for address
      tags: [Address]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Transaction history
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  count: { type: integer }
                  transactions:
                    type: array
                    items:
                      type: object
                      properties:
                        txid: { type: string }
                        height: { type: integer }
                        confirmed: { type: boolean }

  /address/{address}/tokens:
    get:
      operationId: listTokens
      summary: List Glyph tokens held by address
      tags: [Address, Glyph]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 500, default: 100 }
      responses:
        "200":
          description: Token list
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  tokens: { type: array, items: { type: object } }

  /token/{ref}:
    get:
      operationId: getToken
      summary: Get Glyph token info by reference
      tags: [Glyph]
      parameters:
        - name: ref
          in: path
          required: true
          schema: { type: string }
          description: Token reference (txid_vout format)
      responses:
        "200":
          description: Token information
          content:
            application/json:
              schema: { type: object }

  /token/{ref}/metadata:
    get:
      operationId: getTokenMetadata
      summary: Get full CBOR metadata for a token
      tags: [Glyph]
      parameters:
        - name: ref
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Parsed token metadata
          content:
            application/json:
              schema: { type: object }

  /token/{ref}/history:
    get:
      operationId: getTokenHistory
      summary: Get transaction history for a token
      tags: [Glyph]
      parameters:
        - name: ref
          in: path
          required: true
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 100 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Token history
          content:
            application/json:
              schema: { type: object }

  /tokens/search:
    get:
      operationId: searchTokens
      summary: Search tokens by name or ticker
      tags: [Glyph]
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }
          description: Search query
        - name: protocols
          in: query
          schema: { type: string }
          description: Comma-separated protocol IDs to filter
        - name: limit
          in: query
          schema: { type: integer, default: 50 }
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema: { type: object }

  /tokens/type/{typeId}:
    get:
      operationId: getTokensByType
      summary: List tokens by type
      tags: [Glyph]
      parameters:
        - name: typeId
          in: path
          required: true
          schema: { type: integer, minimum: 1, maximum: 11 }
          description: "Token type: 1=FT, 2=NFT, 3=DAT, 4=dMint, 5=MUT, 6=BURN, 7=CONTAINER, 8=ENCRYPTED, 9=TIMELOCK, 10=AUTHORITY, 11=WAVE"
        - name: limit
          in: query
          schema: { type: integer, default: 100 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Tokens of specified type
          content:
            application/json:
              schema: { type: object }

  /dmint/contracts:
    get:
      operationId: getDmintContracts
      summary: List active dMint contracts
      tags: [dMint]
      parameters:
        - name: format
          in: query
          schema: { type: string, enum: [simple, extended], default: extended }
      responses:
        "200":
          description: Mineable token contracts
          content:
            application/json:
              schema: { type: object }

  /dmint/contract/{ref}:
    get:
      operationId: getDmintContract
      summary: Get dMint contract details
      tags: [dMint]
      parameters:
        - name: ref
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Contract details (difficulty, reward, algorithm, supply)
          content:
            application/json:
              schema: { type: object }

  /dmint/algorithm/{algoId}:
    get:
      operationId: getDmintByAlgorithm
      summary: Get dMint contracts by mining algorithm
      tags: [dMint]
      parameters:
        - name: algoId
          in: path
          required: true
          schema: { type: integer, minimum: 0, maximum: 4 }
          description: "Algorithm: 0=SHA256D, 1=BLAKE3, 2=K12"
      responses:
        "200":
          description: Contracts for algorithm
          content:
            application/json:
              schema: { type: object }

  /dmint/profitable:
    get:
      operationId: getMostProfitable
      summary: Get most profitable dMint contracts
      tags: [dMint]
      parameters:
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Contracts sorted by profitability
          content:
            application/json:
              schema: { type: object }

  /wave/resolve/{name}:
    get:
      operationId: resolveWaveName
      summary: Resolve a WAVE name to zone records
      tags: [WAVE]
      parameters:
        - name: name
          in: path
          required: true
          schema: { type: string }
          description: WAVE name (e.g., alice, myapp)
      responses:
        "200":
          description: Name resolution result
          content:
            application/json:
              schema: { type: object }

  /wave/available/{name}:
    get:
      operationId: checkWaveAvailable
      summary: Check if a WAVE name is available
      tags: [WAVE]
      parameters:
        - name: name
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Availability status
          content:
            application/json:
              schema:
                type: object
                properties:
                  name: { type: string }
                  available: { type: boolean }

  /wave/{name}/subdomains:
    get:
      operationId: getWaveSubdomains
      summary: List subdomains of a WAVE name
      tags: [WAVE]
      parameters:
        - name: name
          in: path
          required: true
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 100 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Child names
          content:
            application/json:
              schema: { type: object }

  /wave/stats:
    get:
      operationId: getWaveStats
      summary: Get WAVE naming system statistics
      tags: [WAVE]
      responses:
        "200":
          description: Naming system stats
          content:
            application/json:
              schema: { type: object }

  /swap/orders:
    get:
      operationId: getSwapOrders
      summary: Get open swap orders for a trading pair
      tags: [Swap]
      parameters:
        - name: sell
          in: query
          required: true
          schema: { type: string }
          description: Sell-side token ref (or 'rxd')
        - name: buy
          in: query
          required: true
          schema: { type: string }
          description: Buy-side token ref (or 'rxd')
        - name: limit
          in: query
          schema: { type: integer, default: 100 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Open orders
          content:
            application/json:
              schema: { type: object }

  /validate/{address}:
    get:
      operationId: validateAddress
      summary: Validate a Radiant address
      tags: [Utility]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  valid: { type: boolean }
                  type: { type: string, nullable: true, enum: [P2PKH, P2SH, null] }
                  scripthash: { type: string, nullable: true }

  /protocols:
    get:
      operationId: getProtocolInfo
      summary: Get Glyph protocol type definitions
      tags: [Utility]
      responses:
        "200":
          description: Protocol definitions
          content:
            application/json:
              schema: { type: object }

  # ── Phase 5: AI Primitives ──

  /inference/proof:
    post:
      operationId: createInferenceProof
      summary: Create a blake3 inference proof commitment
      tags: [Inference]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [model_hash, input_hash, output_hex]
              properties:
                model_hash: { type: string, minLength: 64, maxLength: 64, description: Blake3 hash of model weights }
                input_hash: { type: string, minLength: 64, maxLength: 64, description: Blake3 hash of input data }
                output_hex: { type: string, description: Inference output as hex }
      responses:
        "200":
          description: Inference proof commitment
          content:
            application/json:
              schema:
                type: object
                properties:
                  modelHash: { type: string }
                  inputHash: { type: string }
                  commitment: { type: string }
                  timestamp: { type: integer }

  /inference/verify:
    post:
      operationId: verifyInferenceProof
      summary: Verify an inference proof commitment
      tags: [Inference]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [model_hash, input_hash, output_hex, commitment]
              properties:
                model_hash: { type: string }
                input_hash: { type: string }
                output_hex: { type: string }
                commitment: { type: string, minLength: 64, maxLength: 64 }
      responses:
        "200":
          description: Verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid: { type: boolean }
                  commitment: { type: string }
                  message: { type: string }

  /identity/profile:
    post:
      operationId: buildAgentProfile
      summary: Build an AI agent identity profile
      tags: [Identity]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [address, description, capabilities]
              properties:
                address: { type: string, description: Agent Radiant address }
                description: { type: string }
                capabilities: { type: array, items: { type: string } }
                api_url: { type: string }
                pricing: { type: string }
                model: { type: string }
                wave_name: { type: string }
      responses:
        "200":
          description: Agent profile with WAVE records
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile: { type: object }
                  waveRecords: { type: object }

  /identity/resolve/{name}:
    get:
      operationId: resolveAgentIdentity
      summary: Resolve an AI agent identity from WAVE name
      tags: [Identity]
      parameters:
        - name: name
          in: path
          required: true
          schema: { type: string }
          description: Agent WAVE name
      responses:
        "200":
          description: Agent identity
          content:
            application/json:
              schema:
                type: object
                properties:
                  wave_name: { type: string }
                  found: { type: boolean }
                  agent: { type: object, nullable: true }
                  rawZone: { type: object, nullable: true }

  /access/check/{address}/{tokenRef}:
    get:
      operationId: checkTokenAccess
      summary: Check token-gated service access
      tags: [Access]
      parameters:
        - name: address
          in: path
          required: true
          schema: { type: string }
          description: Address to check
        - name: tokenRef
          in: path
          required: true
          schema: { type: string }
          description: Service token reference
        - name: min_balance
          in: query
          schema: { type: integer, minimum: 1, default: 1 }
          description: Minimum token balance required
      responses:
        "200":
          description: Access check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  tokenRef: { type: string }
                  hasAccess: { type: boolean }
                  balance: { type: integer }
                  required: { type: integer }

  /channel/open:
    post:
      operationId: openChannel
      summary: Create initial micropayment channel state
      tags: [Channel]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel_id, agent_a, agent_b, capacity]
              properties:
                channel_id: { type: string, description: Channel ID (funding txid) }
                agent_a: { type: string, description: Payer pubkey hex (66 chars) }
                agent_b: { type: string, description: Payee pubkey hex (66 chars) }
                capacity: { type: integer, minimum: 1, description: Locked amount in photons }
                timeout_blocks: { type: integer, default: 1008, description: Timeout in blocks }
      responses:
        "200":
          description: Channel initial state
          content:
            application/json:
              schema:
                type: object
                properties:
                  channelId: { type: string }
                  agentA: { type: string }
                  agentB: { type: string }
                  capacity: { type: integer }
                  balanceA: { type: integer }
                  balanceB: { type: integer }
                  nonce: { type: integer }
                  stateCommitment: { type: string }
                  summary: { type: string }

  /channel/update:
    post:
      operationId: updateChannel
      summary: Update micropayment channel state
      tags: [Channel]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [channel_id, agent_a, agent_b, capacity, balance_a, balance_b, payment_amount]
              properties:
                channel_id: { type: string }
                agent_a: { type: string }
                agent_b: { type: string }
                capacity: { type: integer }
                balance_a: { type: integer }
                balance_b: { type: integer }
                nonce: { type: integer, default: 0 }
                timeout_blocks: { type: integer, default: 1008 }
                payment_amount: { type: integer, minimum: 1, description: Amount to transfer A→B }
      responses:
        "200":
          description: Updated channel state
          content:
            application/json:
              schema:
                type: object
                properties:
                  channelId: { type: string }
                  balanceA: { type: integer }
                  balanceB: { type: integer }
                  nonce: { type: integer }
                  stateCommitment: { type: string }
                  summary: { type: string }

  /marketplace/asset:
    post:
      operationId: buildDataAsset
      summary: Build Glyph NFT metadata for a data marketplace asset
      tags: [Marketplace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ref, type, name, content_hash]
              properties:
                ref: { type: string, description: NFT reference }
                type: { type: string, enum: [dataset, model, collection, computation] }
                name: { type: string }
                description: { type: string }
                content_hash: { type: string, minLength: 64, maxLength: 64 }
                size_bytes: { type: integer }
                mime_type: { type: string }
                price: { type: integer, default: 0, description: Price in photons }
                derived_from: { type: array, items: { type: string }, description: Parent dataset refs }
                license: { type: string }
      responses:
        "200":
          description: CBOR-ready metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata: { type: object }
                  provenanceCommitment: { type: string, nullable: true }

  /marketplace/search:
    get:
      operationId: searchDataAssets
      summary: Search the data marketplace
      tags: [Marketplace]
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }
          description: Search query
        - name: type
          in: query
          schema: { type: string, enum: [dataset, model, collection, computation] }
        - name: limit
          in: query
          schema: { type: integer, default: 50 }
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  query: { type: string }
                  type: { type: string, nullable: true }
                  results: { type: array, items: { type: object } }

  /health:
    get:
      operationId: getHealth
      summary: Check ElectrumX connection health
      tags: [Health]
      responses:
        "200":
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, enum: [healthy, degraded, unhealthy] }
                  electrumx: { type: object, properties: { connected: { type: boolean }, latencyMs: { type: integer } } }
                  network: { type: string }
                  timestamp: { type: integer }
        "503":
          description: Unhealthy

  # ── Wallet ──

  /wallet/create:
    post:
      operationId: createWallet
      summary: Generate a new Radiant wallet
      tags: [Wallet]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                network: { type: string, enum: [mainnet, testnet], default: mainnet }
                mnemonic: { type: boolean, default: false, description: If true, generate BIP39 mnemonic }
                word_count: { type: integer, enum: [12, 15, 18, 21, 24], default: 12 }
                passphrase: { type: string, default: "", description: Optional BIP39 passphrase }
                path: { type: string, default: "m/44'/0'/0'/0/0", description: BIP32 derivation path }
      responses:
        "200":
          description: New wallet
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  publicKey: { type: string }
                  wif: { type: string }
                  mnemonic: { type: string, nullable: true }
                  derivationPath: { type: string, nullable: true }
                  network: { type: string }

  /wallet/restore:
    post:
      operationId: restoreWallet
      summary: Restore wallet from BIP39 mnemonic
      tags: [Wallet]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [mnemonic]
              properties:
                mnemonic: { type: string, description: BIP39 mnemonic (12-24 words) }
                network: { type: string, enum: [mainnet, testnet], default: mainnet }
                passphrase: { type: string, default: "" }
                path: { type: string, default: "m/44'/0'/0'/0/0" }
      responses:
        "200":
          description: Restored wallet
          content:
            application/json:
              schema:
                type: object
                properties:
                  address: { type: string }
                  publicKey: { type: string }
                  wif: { type: string }
                  derivationPath: { type: string }
                  network: { type: string }
                  valid: { type: boolean }

  /tx/{txid}/decode:
    get:
      operationId: decodeTransaction
      summary: Decode a transaction (verbose)
      tags: [Blockchain]
      parameters:
        - name: txid
          in: path
          required: true
          schema: { type: string, minLength: 64, maxLength: 64 }
      responses:
        "200":
          description: Decoded transaction
          content:
            application/json:
              schema: { type: object }

  /swap/history:
    get:
      operationId: getSwapHistory
      summary: Get trade history for a token
      tags: [Swap]
      parameters:
        - name: ref
          in: query
          required: true
          schema: { type: string }
          description: Token reference
        - name: limit
          in: query
          schema: { type: integer, default: 100 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: Trade history
          content:
            application/json:
              schema:
                type: object
                properties:
                  ref: { type: string }
                  history: { type: array, items: { type: object } }

  /script/decode:
    post:
      operationId: decodeScript
      summary: Decode raw script hex into human-readable opcodes (offline)
      tags: [Script]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [script_hex]
              properties:
                script_hex: { type: string, description: "Script in hexadecimal" }
      responses:
        "200":
          description: Decoded script with opcodes, ASM, and summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  script_hex: { type: string }
                  length: { type: integer }
                  opcodes: { type: array, items: { type: object } }
                  asm: { type: string }
                  summary:
                    type: object
                    properties:
                      total_ops: { type: integer }
                      data_pushes: { type: integer }
                      has_state_separator: { type: boolean }
                      has_references: { type: boolean }
                      has_v2_opcodes: { type: boolean }
                      script_type: { type: string }

  /script/compile:
    post:
      operationId: compileScript
      summary: Compile RadiantScript source code into a deployment artifact (offline)
      description: |
        Compiles `.cash`/`.rxd` source code using the rxdc compiler.
        Requires the rxdc binary (set RXDC_PATH env var or place RadiantScript repo as sibling).
        Returns ABI, ASM bytecode, and optional hex output.
      tags: [Script]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [source]
              properties:
                source: { type: string, description: "RadiantScript source code" }
                format: { type: string, enum: [artifact, asm, hex], default: artifact, description: "Output format" }
                debug: { type: boolean, default: false, description: "Include source and source map for rxdeb debugging" }
      responses:
        "200":
          description: Compilation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  artifact:
                    type: object
                    properties:
                      version: { type: integer }
                      compilerVersion: { type: string }
                      contract: { type: string }
                      abi: { type: array, items: { type: object } }
                      asm: { type: string }
                      hex: { type: string }
                      source: { type: string }
                      sourceMap: { type: object }
                  asm: { type: string }
                  hex: { type: string }
                  warnings: { type: array, items: { type: string } }
        "400":
          description: Compilation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error: { type: string }
